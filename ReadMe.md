# Perftool 2.0 #

## Модель OpenMP-программы ##

* Программа состоит из набора интервалов

* Интервалы соответствуют определению структурного блока: имеют один вход и один выход

* Каждый интервал имеет не более одного родителя. В том числе интервалы не могут быть рекурсивно вложены в себя.

* Нет вложенного параллелизма

* Количество нитей во всех паралельных регионах одинаково

* В master потоке корневым интервалом является вся программа целиком

* В slave потоках не существует корневого интервала. В момент вхождения в параллельный регион текущим интервалом в slave потоке становится текущий активный интервал в master потоке

## NOTES ##

### Родительский интервал в slave-потоках ###

Так как в слэйв потоках не существует DBG_Init, когда приходим в конструкцую DBG_BeforeInterval,
может не оказаться активного родительского интервала. Тогда теряем информацию о вложенности интервалов для слэйв-потоков.
Чтобы решить эту проблему, можно в конструкции BeforeParallel запомнить активный интервал в runtime context.
После этого, в конструкции ParallelEvent сделать активным этот запомненый интервал. ParallelEvent будет играть роль своего рода Init.
То есть алгоритм следующий.

1. Заходим в BeforeInterval и запоминаем активный интервал (его ID) к рантайм контексте,
2. Заходим в ParallelEvent и для слэйв потоков устанавливаем запомненный интервал как активный.

Потенциально могут возникнуть две проблемы.

1. Заходим в BeforeInterval и не находим родительский интервал...

Not finished yet.
